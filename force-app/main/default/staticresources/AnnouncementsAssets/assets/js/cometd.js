"undefined"!=typeof dojo?dojo.provide("org.cometd"):(this.org=this.org||{},org.cometd={}),org.cometd.JSON={},org.cometd.JSON.toJSON=org.cometd.JSON.fromJSON=function(a){throw"Abstract"},org.cometd.Utils={},org.cometd.Utils.isString=function(a){return void 0!==a&&null!==a&&("string"==typeof a||a instanceof String)},org.cometd.Utils.isArray=function(a){return void 0!==a&&null!==a&&a instanceof Array},org.cometd.Utils.inArray=function(a,b){for(var c=0;c<b.length;++c)if(a==b[c])return c;return-1},org.cometd.Utils.setTimeout=function(a,b,c){return setTimeout(function(){try{b()}catch(c){a._debug("Exception invoking timed function",b,c)}},c)},org.cometd.TransportRegistry=function(){var a=[],b={};this.getTransportTypes=function(){return a.slice(0)},this.findTransportTypes=function(c,d,e){for(var f=[],g=0;g<a.length;++g){var h=a[g];!0===b[h].accept(c,d,e)&&f.push(h)}return f},this.negotiateTransport=function(c,d,e,f){for(var g=0;g<a.length;++g)for(var h=a[g],i=0;i<c.length;++i)if(h==c[i]){var j=b[h];if(!0===j.accept(d,e,f))return j}return null},this.add=function(c,d,e){for(var f=!1,g=0;g<a.length;++g)if(a[g]==c){f=!0;break}return f||("number"!=typeof e?a.push(c):a.splice(e,0,c),b[c]=d),!f},this.find=function(c){for(var d=0;d<a.length;++d)if(a[d]==c)return b[c];return null},this.remove=function(c){for(var d=0;d<a.length;++d)if(a[d]==c){a.splice(d,1);var e=b[c];return delete b[c],e}return null},this.reset=function(){for(var c=0;c<a.length;++c)b[a[c]].reset()}},org.cometd.Transport=function(){var a,b;this.registered=function(c,d){a=c,b=d},this.unregistered=function(){a=null,b=null},this._debug=function(){b._debug.apply(b,arguments)},this._mixin=function(){return b._mixin.apply(b,arguments)},this.getConfiguration=function(){return b.getConfiguration()},this.getAdvice=function(){return b.getAdvice()},this.setTimeout=function(a,c){return org.cometd.Utils.setTimeout(b,a,c)},this.convertToMessages=function(a){if(org.cometd.Utils.isString(a))try{return org.cometd.JSON.fromJSON(a)}catch(b){throw this._debug("Could not convert to JSON the following string",'"'+a+'"'),b}if(org.cometd.Utils.isArray(a))return a;if(void 0===a||null===a)return[];if(a instanceof Object)return[a];throw"Conversion Error "+a+", typeof "+typeof a},this.accept=function(a,b,c){throw"Abstract"},this.getType=function(){return a},this.send=function(a,b){throw"Abstract"},this.reset=function(){this._debug("Transport",a,"reset")},this.abort=function(){this._debug("Transport",a,"aborted")},this.toString=function(){return this.getType()}},org.cometd.Transport.derive=function(a){function b(){}return b.prototype=a,new b},org.cometd.RequestTransport=function(){function g(a){for(;f.length>0;){var b=f[0],c=b[0],d=b[1];if(c.url!==a.url||c.sync!==a.sync)break;f.shift(),a.messages=a.messages.concat(c.messages),this._debug("Coalesced",c.messages.length,"messages from request",d.id)}}function h(a,b){if(this.transportSend(a,b),b.expired=!1,!a.sync){var c=this.getConfiguration().maxNetworkDelay,d=c;!0===b.metaConnect&&(d+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"waiting at most",d,"ms for the response, maxNetworkDelay",c);var e=this;b.timeout=this.setTimeout(function(){b.expired=!0,b.xhr&&b.xhr.abort();var c="Request "+b.id+" of transport "+e.getType()+" exceeded "+d+" ms max network delay";e._debug(c),e.complete(b,!1,b.metaConnect),a.onFailure(b.xhr,a.messages,"timeout",c)},d)}}function i(a){var b=++c,d={id:b,metaConnect:!1};e.length<this.getConfiguration().maxConnections-1?(e.push(d),h.call(this,a,d)):(this._debug("Transport",this.getType(),"queueing request",b,"envelope",a),f.push([a,d]))}function j(a){var b=a.id;if(this._debug("Transport",this.getType(),"metaConnect complete, request",b),null!==d&&d.id!==b)throw"Longpoll request mismatch, completing request "+b;d=null}function k(a,b){var c=org.cometd.Utils.inArray(a,e);if(c>=0&&e.splice(c,1),f.length>0){var d=f.shift(),h=d[0],j=d[1];if(this._debug("Transport dequeued request",j.id),b)this.getConfiguration().autoBatch&&g.call(this,h),i.call(this,h),this._debug("Transport completed request",a.id,h);else{var k=this;this.setTimeout(function(){k.complete(j,!1,j.metaConnect),h.onFailure(j.xhr,h.messages,"error","Previous request failed")},0)}}}function l(a){if(null!==d)throw"Concurrent metaConnect requests not allowed, request id="+d.id+" not yet completed";var b=++c;this._debug("Transport",this.getType(),"metaConnect send, request",b,"envelope",a);var e={id:b,metaConnect:!0};h.call(this,a,e),d=e}var a=new org.cometd.Transport,b=org.cometd.Transport.derive(a),c=0,d=null,e=[],f=[];return b.complete=function(a,b,c){c?j.call(this,a):k.call(this,a,b)},b.transportSend=function(a,b){throw"Abstract"},b.transportSuccess=function(a,b,c){b.expired||(clearTimeout(b.timeout),this.complete(b,!0,b.metaConnect),c&&c.length>0?a.onSuccess(c):a.onFailure(b.xhr,a.messages,"Empty HTTP response"))},b.transportFailure=function(a,b,c,d){b.expired||(clearTimeout(b.timeout),this.complete(b,!1,b.metaConnect),a.onFailure(b.xhr,a.messages,c,d))},b.send=function(a,b){b?l.call(this,a):i.call(this,a)},b.abort=function(){a.abort();for(var b=0;b<e.length;++b){var c=e[b];this._debug("Aborting request",c),c.xhr&&c.xhr.abort()}d&&(this._debug("Aborting metaConnect request",d),d.xhr&&d.xhr.abort()),this.reset()},b.reset=function(){a.reset(),d=null,e=[],f=[]},b},org.cometd.LongPollingTransport=function(){var a=new org.cometd.RequestTransport,b=org.cometd.Transport.derive(a),c=!0;return b.accept=function(a,b,d){return c||!b},b.xhrSend=function(a){throw"Abstract"},b.transportSend=function(a,b){this._debug("Transport",this.getType(),"sending request",b.id,"envelope",a);var d=this;try{var e=!0;b.xhr=this.xhrSend({transport:this,url:a.url,sync:a.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(a.messages),onSuccess:function(e){d._debug("Transport",d.getType(),"received response",e);var f=!1;try{var g=d.convertToMessages(e);0===g.length?(c=!1,d.transportFailure(a,b,"no response",null)):(f=!0,d.transportSuccess(a,b,g))}catch(e){d._debug(e),f||(c=!1,d.transportFailure(a,b,"bad response",e))}},onError:function(f,g){c=!1,e?d.setTimeout(function(){d.transportFailure(a,b,f,g)},0):d.transportFailure(a,b,f,g)}}),e=!1}catch(e){c=!1,this.setTimeout(function(){d.transportFailure(a,b,"error",e)},0)}},b.reset=function(){a.reset(),c=!0},b},org.cometd.CallbackPollingTransport=function(){var a=new org.cometd.RequestTransport,b=org.cometd.Transport.derive(a),c=2e3;return b.accept=function(a,b,c){return!0},b.jsonpSend=function(a){throw"Abstract"},b.transportSend=function(a,b){for(var d=this,e=0,f=a.messages.length,g=[];f>0;){var h=org.cometd.JSON.toJSON(a.messages.slice(e,e+f)),i=a.url.length+encodeURI(h).length;if(i>c){if(1==f){var j="Bayeux message too big ("+i+" bytes, max is "+c+") for transport "+this.getType();return void this.setTimeout(function(){d.transportFailure(a,b,"error",j)},0)}--f}else g.push(f),e+=f,f=a.messages.length-e}var k=a;if(g.length>1){var l=0,m=g[0];this._debug("Transport",this.getType(),"split",a.messages.length,"messages into",g.join(" + ")),k=this._mixin(!1,{},a),k.messages=a.messages.slice(l,m),k.onSuccess=a.onSuccess,k.onFailure=a.onFailure;for(var n=1;n<g.length;++n){var o=this._mixin(!1,{},a);l=m,m+=g[n],o.messages=a.messages.slice(l,m),o.onSuccess=a.onSuccess,o.onFailure=a.onFailure,this.send(o,b.metaConnect)}}this._debug("Transport",this.getType(),"sending request",b.id,"envelope",k);try{var p=!0;this.jsonpSend({transport:this,url:k.url,sync:k.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(k.messages),onSuccess:function(a){var c=!1;try{var e=d.convertToMessages(a);0===e.length?d.transportFailure(k,b,"no response"):(c=!0,d.transportSuccess(k,b,e))}catch(a){d._debug(a),c||d.transportFailure(k,b,"bad response",a)}},onError:function(a,c){p?d.setTimeout(function(){d.transportFailure(k,b,a,c)},0):d.transportFailure(k,b,a,c)}}),p=!1}catch(a){this.setTimeout(function(){d.transportFailure(k,b,"error",a)},0)}},b},org.cometd.WebSocketTransport=function(){function m(a,b){try{var c=org.cometd.JSON.toJSON(a.messages);k.send(c),this._debug("Transport",this.getType(),"sent",a,"metaConnect =",b);var d=this.getConfiguration().maxNetworkDelay,e=d;b&&(e+=this.getAdvice().timeout);for(var f=[],g=0;g<a.messages.length;++g){var h=a.messages[g];if(h.id){f.push(h.id);var l=this;i[h.id]=this.setTimeout(function(){var b="Message "+h.id+" of transport "+l.getType()+" exceeded "+e+" ms max network delay";l._debug(b),delete i[h.id];for(var c in j)if(j[c]===a){delete j[c];break}a.onFailure(k,a.messages,"timeout",b)},e)}}this._debug("Transport",this.getType(),"waiting at most",e," ms for messages",f,"maxNetworkDelay",d,", timeouts:",i)}catch(b){this.setTimeout(function(){a.onFailure(k,a.messages,"error",b)},0)}}var e,k,l,a=1,b=2,c=new org.cometd.Transport,d=org.cometd.Transport.derive(c),f=!0,g=!1,h=b,i={},j={};return d.registered=function(a,b){c.registered(a,b),e=b},d.accept=function(a,b,c){return f&&!!window.WebSocket&&!0===e.websocketEnabled},d.onMessage=function(b){if(this._debug("Transport",this.getType(),"received websocket message",b),h===a){for(var c=this.convertToMessages(b.data),d=[],e=0;e<c.length;++e){var f=c[e];if((/^\/meta\//.test(f.channel)||void 0===f.data)&&f.id){d.push(f.id);var g=i[f.id];g&&(clearTimeout(g),delete i[f.id],this._debug("Transport",this.getType(),"removed timeout for message",f.id,", timeouts",i))}"/meta/disconnect"===f.channel&&f.successful&&k.close()}for(var m=!1,n=0;n<d.length;++n){var o=d[n];for(var p in j){var q=p.split(","),r=org.cometd.Utils.inArray(o,q);if(r>=0){m=!0,q.splice(r,1);var s=j[p];delete j[p],q.length>0&&(j[q.join(",")]=s);break}}}m&&this._debug("Transport",this.getType(),"removed envelope, envelopes",j),l.call(this,c)}},d.onClose=function(){this._debug("Transport",this.getType(),"closed",k),f=g;for(var a in i)clearTimeout(i[a]),delete i[a];for(var c in j)j[c].onFailure(k,j[c].messages,"closed"),delete j[c];h=b},d.send=function(b,c){this._debug("Transport",this.getType(),"sending",b,"metaConnect =",c);for(var d=[],e=0;e<b.messages.length;++e){var f=b.messages[e];f.id&&d.push(f.id)}if(j[d.join(",")]=b,this._debug("Transport",this.getType(),"stored envelope, envelopes",j),h===a)m.call(this,b,c);else{var i=b.url.replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",i),k=new window.WebSocket(i);var n=this;k.onopen=function(){n._debug("WebSocket opened",k),g=!0,h=a,l=b.onSuccess,m.call(n,b,c)},k.onclose=function(){n.onClose()},k.onmessage=function(a){n.onMessage(a)}}},d.reset=function(){c.reset(),k&&k.close(),f=!0,g=!1,h=b,i={},j={},k=null,l=null},d},org.cometd.Cometd=function(a){function v(a,b,c){for(var d=b||{},e=2;e<arguments.length;++e){var f=arguments[e];if(void 0!==f&&null!==f)for(var g in f){var h=f[g];h!==b&&(void 0!==h&&(a&&"object"==typeof h&&null!==h?h instanceof Array?d[g]=v(a,[],h):d[g]=v(a,{},h):d[g]=h))}}return d}function w(a){return org.cometd.Utils.isString(a)}function x(a){return void 0!==a&&null!==a&&"function"==typeof a}function y(a,b){if(window.console){var c=window.console[a];x(c)&&c.apply(window.console,b)}}function z(){y("warn",arguments)}function A(){"warn"!=u.logLevel&&y("info",arguments)}function B(){"debug"==u.logLevel&&y("debug",arguments)}function C(a){if(B("Configuring cometd object with",a),w(a)&&(a={url:a}),a||(a={}),u=v(!1,u,a),!u.url)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var b=/(^https?:)?(\/\/(([^:\/\?#]+)(:(\d+))?))?([^\?#]*)(.*)?/.exec(u.url);if(d=b[3]&&b[3]!=window.location.host,u.appendMessageTypeToURL)if(void 0!==b[8]&&b[8].length>0)A("Appending message type to URI "+b[7]+b[8]+" is not supported, disabling 'appendMessageTypeToURL' configuration"),u.appendMessageTypeToURL=!1;else{var c=b[7].split("/"),e=c.length-1;b[7].match(/\/$/)&&(e-=1),c[e].indexOf(".")>=0&&(A("Appending message type to URI "+b[7]+" is not supported, disabling 'appendMessageTypeToURL' configuration"),u.appendMessageTypeToURL=!1)}}function D(){for(var a in m)for(var b=m[a],c=0;c<b.length;++c){var d=b[c];d&&!d.listener&&(delete b[c],B("Removed subscription",d,"for channel",a))}}function E(a){g!=a&&(B("Status",g,"->",a),g=a)}function F(){return"disconnecting"==g||"disconnected"==g}function G(){return++h}function H(a,c,d,e,f){try{return c.call(a,e)}catch(a){B("Exception during execution of extension",d,a);var g=b.onExtensionException;if(x(g)){B("Invoking extension exception callback",d,a);try{g.call(b,a,d,f,e)}catch(a){A("Exception during execution of exception callback in extension",d,a)}}return e}}function I(a){for(var b=0;b<p.length&&(void 0!==a&&null!==a);++b){var c=u.reverseIncomingExtensions?p.length-1-b:b,d=p[c],e=d.extension.incoming;if(x(e)){var f=H(d.extension,e,d.name,a,!1);a=void 0===f?a:f}}return a}function J(a){for(var b=0;b<p.length&&(void 0!==a&&null!==a);++b){var c=p[b],d=c.extension.outgoing;if(x(d)){var e=H(c.extension,d,c.name,a,!0);a=void 0===e?a:e}}return a}function K(a,c){var d=m[a];if(d&&d.length>0)for(var e=0;e<d.length;++e){var f=d[e];if(f)try{f.callback.call(f.scope,c)}catch(a){B("Exception during notification",f,c,a);var g=b.onListenerException;if(x(g)){B("Invoking listener exception callback",f,a);try{g.call(b,a,f.handle,f.listener,c)}catch(a){A("Exception during execution of listener callback",f,a)}}}}}function L(a,b){K(a,b);for(var c=a.split("/"),d=c.length-1,e=d;e>0;--e){var f=c.slice(0,e).join("/")+"/*";e==d&&K(f,b),f+="*",K(f,b)}}function M(){null!==o&&clearTimeout(o),o=null}function N(a){M();var c=q.interval+n;B("Function scheduled in",c,"ms, interval =",q.interval,"backoff =",n,a),o=org.cometd.Utils.setTimeout(b,a,c)}function Q(a,c,d,e){for(var g=0;g<c.length;++g){var h=c[g];h.id=""+G(),i&&(h.clientId=i),h=J(h),void 0!==h&&null!==h?c[g]=h:c.splice(g--,1)}if(0!==c.length){var j=u.url;u.appendMessageTypeToURL&&(j.match(/\/$/)||(j+="/"),e&&(j+=e));var k={url:j,sync:a,messages:c,onSuccess:function(a){try{O.call(b,a)}catch(a){B("Exception during handling of messages",a)}},onFailure:function(a,c,d,e){try{P.call(b,a,c,d,e)}catch(a){B("Exception during handling of failure",a)}}};B("Send",k),f.send(k,d)}}function R(a){j>0||!0===l?k.push(a):Q(!1,[a],!1)}function S(){n=0}function T(){n<u.maxBackoff&&(n+=u.backoffIncrement)}function U(){++j}function V(){var a=k;k=[],a.length>0&&Q(!1,a,!1)}function W(){if(--j<0)throw"Calls to startBatch() and endBatch() are not paired";0!==j||F()||l||V()}function X(){if(!F()){var a={channel:"/meta/connect",connectionType:f.getType()};t||(a.advice={timeout:0}),E("connecting"),B("Connect sent",a),Q(!1,[a],!0,"connect"),E("connected")}}function Y(){E("connecting"),N(function(){X()})}function Z(a){a&&(q=v(!1,{},u.advice,a),B("New advice",q))}function $(a){M(),a&&f.abort(),i=null,E("disconnected"),j=0,S(),k.length>0&&(P.call(b,void 0,k,"error","Disconnected"),k=[])}function _(a){i=null,D(),F()?(e.reset(),Z(u.advice)):Z(v(!1,q,{reconnect:"retry"})),j=0,l=!0,r=a;var b="1.0",c=e.findTransportTypes(b,d,u.url),g={version:b,minimumVersion:"0.9",channel:"/meta/handshake",supportedConnectionTypes:c,advice:{timeout:q.timeout,interval:q.interval}},h=v(!1,{},r,g);f=e.negotiateTransport(c,b,d,u.url),B("Initial transport is",f.getType()),E("handshaking"),B("Handshake sent",h),Q(!1,[h],!1,"handshake")}function aa(){E("handshaking"),l=!0,N(function(){_(r)})}function ba(a){L("/meta/handshake",a),L("/meta/unsuccessful",a),F()||"none"==q.reconnect?$(!1):(T(),aa())}function ca(a){if(a.successful){i=a.clientId;var b=e.negotiateTransport(a.supportedConnectionTypes,a.version,d,u.url);if(null===b)throw"Could not negotiate transport with server; client "+e.findTransportTypes(a.version,d,u.url)+", server "+a.supportedConnectionTypes;f!=b&&(B("Transport",f,"->",b),f=b),l=!1,V(),a.reestablish=s,s=!0,L("/meta/handshake",a);var c=F()?"none":q.reconnect;switch(c){case"retry":S(),Y();break;case"none":$(!1);break;default:throw"Unrecognized advice action "+c}}else ba(a)}function da(a,b){ba({successful:!1,failure:!0,channel:"/meta/handshake",request:b,xhr:a,advice:{reconnect:"retry",interval:n}})}function ea(a){L("/meta/connect",a),L("/meta/unsuccessful",a);var b=F()?"none":q.reconnect;switch(b){case"retry":T(),Y();break;case"handshake":e.reset(),S(),aa();break;case"none":$(!1);break;default:throw"Unrecognized advice action"+b}}function fa(a){if(t=a.successful){L("/meta/connect",a);var b=F()?"none":q.reconnect;switch(b){case"retry":S(),Y();break;case"none":$(!1);break;default:throw"Unrecognized advice action "+b}}else ea(a)}function ga(a,b){t=!1,ea({successful:!1,failure:!0,channel:"/meta/connect",request:b,xhr:a,advice:{reconnect:"retry",interval:n}})}function ha(a){$(!0),L("/meta/disconnect",a),L("/meta/unsuccessful",a)}function ia(a){a.successful?($(!1),L("/meta/disconnect",a)):ha(a)}function ja(a,b){ha({successful:!1,failure:!0,channel:"/meta/disconnect",request:b,xhr:a,advice:{reconnect:"none",interval:0}})}function ka(a){L("/meta/subscribe",a),L("/meta/unsuccessful",a)}function la(a){a.successful?L("/meta/subscribe",a):ka(a)}function ma(a,b){ka({successful:!1,failure:!0,channel:"/meta/subscribe",request:b,xhr:a,advice:{reconnect:"none",interval:0}})}function na(a){L("/meta/unsubscribe",a),L("/meta/unsuccessful",a)}function oa(a){a.successful?L("/meta/unsubscribe",a):na(a)}function pa(a,b){na({successful:!1,failure:!0,channel:"/meta/unsubscribe",request:b,xhr:a,advice:{reconnect:"none",interval:0}})}function qa(a){L("/meta/publish",a),L("/meta/unsuccessful",a)}function ra(a){void 0===a.successful?a.data?L(a.channel,a):B("Unknown message",a):a.successful?L("/meta/publish",a):qa(a)}function sa(a,b){qa({successful:!1,failure:!0,channel:b.channel,request:b,xhr:a,advice:{reconnect:"none",interval:0}})}function ta(a){if(void 0!==(a=I(a))&&null!==a){Z(a.advice);switch(a.channel){case"/meta/handshake":ca(a);break;case"/meta/connect":fa(a);break;case"/meta/disconnect":ia(a);break;case"/meta/subscribe":la(a);break;case"/meta/unsubscribe":oa(a);break;default:ra(a)}}}function ua(a){var b=m[a];if(b)for(var c=0;c<b.length;++c)if(b[c])return!0;return!1}function va(a,b){var c={scope:a,method:b};if(x(a))c.scope=void 0,c.method=a;else if(w(b)){if(!a)throw"Invalid scope "+a;if(c.method=a[b],!x(c.method))throw"Invalid callback "+b+" for scope "+a}else if(!x(b))throw"Invalid callback "+b;return c}function wa(a,b,c,d){var e=va(b,c);B("Adding listener on",a,"with scope",e.scope,"and callback",e.method);var f={channel:a,scope:e.scope,callback:e.method,listener:d},g=m[a];g||(g=[],m[a]=g);var h=g.push(f)-1;return f.id=h,f.handle=[a,h],B("Added listener",f,"for channel",a,"having id =",h),f.handle}function xa(a){var b=m[a[0]];b&&(delete b[a[1]],B("Removed listener",a))}var f,r,b=this,c=a||"default",d=!1,e=new org.cometd.TransportRegistry,g="disconnected",h=0,i=null,j=0,k=[],l=!1,m={},n=0,o=null,p=[],q={},s=!1,t=!1,u={maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",reverseIncomingExtensions:!0,maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,advice:{timeout:6e4,interval:0,reconnect:"retry"}};this._mixin=v,this._warn=z,this._info=A,this._debug=B;var O,P;this.send=R,this.receive=ta,O=function(b){B("Received",b);for(var c=0;c<b.length;++c){ta(b[c])}},P=function(b,c,d,e){B("handleFailure",b,c,d,e);for(var f=0;f<c.length;++f){var g=c[f];switch(g.channel){case"/meta/handshake":da(b,g);break;case"/meta/connect":ga(b,g);break;case"/meta/disconnect":ja(b,g);break;case"/meta/subscribe":ma(b,g);break;case"/meta/unsubscribe":pa(b,g);break;default:sa(b,g)}}},this.registerTransport=function(a,b,c){var d=e.add(a,b,c);return d&&(B("Registered transport",a),x(b.registered)&&b.registered(a,this)),d},this.getTransportTypes=function(){return e.getTransportTypes()},this.unregisterTransport=function(a){var b=e.remove(a);return null!==b&&(B("Unregistered transport",a),x(b.unregistered)&&b.unregistered()),b},this.findTransport=function(a){return e.find(a)},this.configure=function(a){C.call(this,a)},this.init=function(a,b){this.configure(a),this.handshake(b)},this.handshake=function(a){E("disconnected"),s=!1,_(a)},this.disconnect=function(a,b){if(!F()){void 0===b&&"boolean"!=typeof a&&(b=a,a=!1);var c={channel:"/meta/disconnect"},d=v(!1,{},b,c);E("disconnecting"),Q(!0===a,[d],!1,"disconnect")}},this.startBatch=function(){U()},this.endBatch=function(){W()},this.batch=function(a,b){var c=va(a,b);this.startBatch();try{c.method.call(c.scope),this.endBatch()}catch(a){throw B("Exception during execution of batch",a),this.endBatch(),a}},this.addListener=function(a,b,c){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!w(a))throw"Illegal argument type: channel must be a string";return wa(a,b,c,!0)},this.removeListener=function(a){if(!org.cometd.Utils.isArray(a))throw"Invalid argument: expected subscription, not "+a;xa(a)},this.clearListeners=function(){m={}},this.subscribe=function(a,b,c,d){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!w(a))throw"Illegal argument type: channel must be a string";if(F())throw"Illegal state: already disconnected";x(b)&&(d=c,c=b,b=void 0);var e=!ua(a),f=wa(a,b,c,!1);if(e){R(v(!1,{},d,{channel:"/meta/subscribe",subscription:a}))}return f},this.unsubscribe=function(a,b){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(F())throw"Illegal state: already disconnected";this.removeListener(a);var c=a[0];if(!ua(c)){R(v(!1,{},b,{channel:"/meta/unsubscribe",subscription:c}))}},this.clearSubscriptions=function(){D()},this.publish=function(a,b,c){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!w(a))throw"Illegal argument type: channel must be a string";if(F())throw"Illegal state: already disconnected";R(v(!1,{},c,{channel:a,data:b}))},this.getStatus=function(){return g},this.isDisconnected=F,this.setBackoffIncrement=function(a){u.backoffIncrement=a},this.getBackoffIncrement=function(){return u.backoffIncrement},this.getBackoffPeriod=function(){return n},this.setLogLevel=function(a){u.logLevel=a},this.registerExtension=function(a,b){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!w(a))throw"Illegal argument type: extension name must be a string";for(var c=!1,d=0;d<p.length;++d){if(p[d].name==a){c=!0;break}}return c?(A("Could not register extension with name",a,"since another extension with the same name already exists"),!1):(p.push({name:a,extension:b}),B("Registered extension",a),x(b.registered)&&b.registered(a,this),!0)},this.unregisterExtension=function(a){if(!w(a))throw"Illegal argument type: extension name must be a string";for(var b=!1,c=0;c<p.length;++c){var d=p[c];if(d.name==a){p.splice(c,1),b=!0,B("Unregistered extension",a);var e=d.extension;x(e.unregistered)&&e.unregistered();break}}return b},this.getExtension=function(a){for(var b=0;b<p.length;++b){var c=p[b];if(c.name==a)return c.extension}return null},this.getName=function(){return c},this.getClientId=function(){return i},this.getURL=function(){return u.url},this.getTransport=function(){return f},this.getConfiguration=function(){return v(!0,{},u)},this.getAdvice=function(){return v(!0,{},q)}};